
<html>
<head>
    <meta charset="UTF-8">
    <title>故宫DEMO</title>

    <link rel="stylesheet" href="css/zoom-marker.css"/>
    <link rel="stylesheet" href="css/easy-loading.css"/>


    <link rel="stylesheet" type="text/css" href="css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.3.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="css/demo.css" />

    <!--必要样式-->
    <link rel="stylesheet" type="text/css" href="css/style2.css" />

    <script src="js/modernizr-custom.js"></script>

    <style>
        .zoom-marker-navigator{
            width: 100%;
            margin: 10px;
            text-align: center;
        }

        .zoom-marker-div{

            height:100vh;

        }


    </style>

</head>
<body>


<div id="scene-map">
    <div id="zoom-marker-div" class="zoom-marker-div">
        <img class="zoom-marker-img" id="zoom-marker-img" alt="zoom-marker-img" name="zoom-marker-img"  draggable="false"/>
 </div>
</div>

<div id="scene-pos1" class="demo-2">

    <div class="container">


        <header class="codrops-header">
            <nav class="codrops-demos">
                <a id="btn_back">返回</a>
                <a id="btn_360">3D环视</a>
            </nav>
        </header>

        <div class="content">
            <div class="grid">
                <div class="grid__item" data-size="1280x857">
                    <a href="img/original/g1.jpg" class="img-wrap"><img src="img/original/g1.jpg" alt="img06" />
                        <div class="description description--grid">
                            <h3>位置1</h3>
                            <p>介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍. </p>

                        </div>
                    </a>
                </div>
                <div class="grid__item" data-size="1280x1280">
                    <a href="img/original/g2.jpg" class="img-wrap"><img src="img/original/g2.jpg" alt="img07" />
                        <div class="description description--grid">
                            <h3>位置2</h3>
                            <p>介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍.</p>

                        </div>
                    </a>
                </div>
                <div class="grid__item" data-size="1280x853">
                    <a href="img/original/g3.jpg" class="img-wrap"><img src="img/original/g3.jpg" alt="img08" />
                        <div class="description description--grid">
                            <h3>位置3</h3>
                            <p>介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍介绍.</p>

                        </div>
                    </a>
                </div>  
            </div>

            <div class="preview">
                <button class="action action--close"><i class="fa fa-times"></i><span class="text-hidden">Close</span></button>
                <div class="description description--preview"></div>
            </div>

        </div>


    </div>


</div>


<script src="js/jquery-3.3.1.min.js"></script>



<script type="text/javascript" src="js/imagesloaded.pkgd.min.js"></script>
<script type="text/javascript" src="js/masonry.pkgd.min.js"></script>
<script type="text/javascript" src="js/classie.js"></script>
<script type="text/javascript" src="js/main.js"></script>

<script type="text/javascript">
(function() {
    var support = { transitions: Modernizr.csstransitions },
        // transition end event name
        transEndEventNames = { 'WebkitTransition': 'webkitTransitionEnd', 'MozTransition': 'transitionend', 'OTransition': 'oTransitionEnd', 'msTransition': 'MSTransitionEnd', 'transition': 'transitionend' },
        transEndEventName = transEndEventNames[ Modernizr.prefixed( 'transition' ) ],
        onEndTransition = function( el, callback ) {
            var onEndCallbackFn = function( ev ) {
                if( support.transitions ) {
                    if( ev.target != this ) return;
                    this.removeEventListener( transEndEventName, onEndCallbackFn );
                }
                if( callback && typeof callback === 'function' ) { callback.call(this); }
            };
            if( support.transitions ) {
                el.addEventListener( transEndEventName, onEndCallbackFn );
            }
            else {
                onEndCallbackFn();
            }
        };

    new GridFx(document.querySelector('.grid'), {
        imgPosition : {
            x : -0.5,
            y : 1
        },
        onOpenItem : function(instance, item) {
            instance.items.forEach(function(el) {
                if(item != el) {
                    var delay = Math.floor(Math.random() * 50);
                    el.style.WebkitTransition = 'opacity .5s ' + delay + 'ms cubic-bezier(.7,0,.3,1), -webkit-transform .5s ' + delay + 'ms cubic-bezier(.7,0,.3,1)';
                    el.style.transition = 'opacity .5s ' + delay + 'ms cubic-bezier(.7,0,.3,1), transform .5s ' + delay + 'ms cubic-bezier(.7,0,.3,1)';
                    el.style.WebkitTransform = 'scale3d(0.1,0.1,1)';
                    el.style.transform = 'scale3d(0.1,0.1,1)';
                    el.style.opacity = 0;
                }
            });
        },
        onCloseItem : function(instance, item) {
            instance.items.forEach(function(el) {
                if(item != el) {
                    el.style.WebkitTransition = 'opacity .4s, -webkit-transform .4s';
                    el.style.transition = 'opacity .4s, transform .4s';
                    el.style.WebkitTransform = 'scale3d(1,1,1)';
                    el.style.transform = 'scale3d(1,1,1)';
                    el.style.opacity = 1;

                    onEndTransition(el, function() {
                        el.style.transition = 'none';
                        el.style.WebkitTransform = 'none';
                    });
                }
            });
        }
    });

    
})();
</script>




</body>


<script src="js/jquery.mousewheel.min.js"></script>
<script src="js/hammer.min.js"></script>

<script src="js/zoom-marker.min.js"></script>
<script src="js/easy-loading.js"></script>


<script type="text/javascript" src="source/jquery.fancybox.js?v=2.1.5"></script>
<link rel="stylesheet" type="text/css" href="source/jquery.fancybox.css?v=2.1.5" media="screen" />

<script>

    var picTag = 0;
    var tagNumber = 1;


    // this array stores the styles for EASY-LOADING
    var styleList = [
        "BALL_PULSE",
        "BALL_CLIP_ROTATE", "BALL_CLIP_ROTATE_PULSE", "SQURE_SPIN", "BALL_CLIP_ROTATE_MULTIPLE",
        "BALL_PULSE_RISE", "BALL_ROTATE", "CUBE_TRANSITION", "BALL_ZIP_ZAG", "BALL_ZIP_ZAG_DEFLECT",
        "BALL_TRIANGLE_PATH", "BALL_SCALE", "LINE_SCALE", "LINE_SCALE_PARTY", "BALL_SCALE_MULTIPLE",
        "BALL_PULSE_SYNC", "BALL_BEAT", "LINE_SCALE_PULSE_OUT", "LINE_SCALE_PULSE_OUT_RAPID",
        "BALL_SCALE_RIPPLE", "BALL_SCALE_RIPPLE_MULTIPLE", "BALL_SPIN_FADE_LOADER", "LINK_SPIN_FADE_LOADER",
        "TRIANGLE_SKEW_SPIN", "PACMAN", "SEMI_CIRCLE_SPIN"
    ];

    var stylePosition = 9;
    $('#zoom-marker-btn-loading').click(function(e){
        EasyLoading.show({
            text: $("<span>"+styleList[stylePosition]+"</span>"),
            button:$("<span>dismiss</span>"),
            type: EasyLoading.TYPE[styleList[stylePosition]],
            //timeout: EasyLoading.TIMEOUT.FAST,
            callback: function(event, data){
                switch(event){
                    case 'on_btn_click' : console.log(data); break;
                    case 'on_loaded' : console.log("callback with options:"+JSON.stringify(data)); break;
                }
            }
        });
        if(++stylePosition>=styleList.length)
            stylePosition = 0;
    });

    var isEnableDrag = true;
    $('#zoom-marker-btn-enable-drag').click(function(e) {
        isEnableDrag = !isEnableDrag;
        $('#zoom-marker-img').zoomMarker_EnableDrag(isEnableDrag);
        if(isEnableDrag) {
            $('#zoom-marker-btn-enable-drag').text('disable drag');
        } else {
            $('#zoom-marker-btn-enable-drag').text('enable drag');
        }
    });

    $('#zoom-marker-btn-reset').click(function(e) {
        $('#zoom-marker-img').zoomMarker_ResetImage();
    });

    // init item
    var initImg = function(item) {
        // handle "TAP" event and add marker to image
        item.on("zoom_marker_mouse_click", function(event, position){

            return;


            console.log("Mouse click on: "+JSON.stringify(position));
            const marker = item.zoomMarker_AddMarker({
                src:"img/marker.svg",
                x:position.x,
                y:position.y,
                size:30,
                dialog:{},
                hint:{value:tagNumber, style:{color:"#ffffff", left:"10px"}}
            });
            // 手动配置dialog
            marker.param.dialog = {
                value: "<h4>content for dialog_"+tagNumber+"</h4>",
                offsetX: 20,
                style: {
                    "border-color": "#86df5f"
                }
            };
            // 画线
            const context = item.zoomMarker_Canvas();
            if(context !== null) {
                context.strokeStyle = 'red';
                context.moveTo(position.x, position.y);
                context.lineTo(100,100);
                context.stroke();
            }
            if(++tagNumber>=10)
                tagNumber=1;
        });

        // listen to marker click event, print to console and delete the marker
        item.on("zoom_marker_click", function(event, marker){
            console.log("click= ",JSON.stringify(marker));
            //$('#zoom-marker-img').zoomMarker_RemoveMarker(marker.id);
            $('#scene-map').hide();
            console.log("scene-map hide");
            $('#scene-pos1').show();
			
			var myResizeEvent = new Event('resize');
            window.dispatchEvent(myResizeEvent);
			
        });

        // message for the beginning of image loading process
        item.on("zoom_marker_img_load", function(event, src){
            console.log("loading started for image : "+src);
            EasyLoading.show({
                text: $("<span>Loading...</span>"),

                type: EasyLoading.TYPE.LINE_SCALE
            });
        });

        // message for image loaded
        item.on("zoom_marker_img_loaded", function(event, size){
            console.log("image has been loaded with size: "+JSON.stringify(size));
            // we have to set a timer in order to watching the loader in local environment, cause the loading speed is too fast
            setTimeout(function(){
                EasyLoading.hide();
            }, 3000);
        });
    }


    initImg($('#zoom-marker-img'));
	
	function fullScreen(el) {  
        var rfs = el.requestFullScreen || el.webkitRequestFullScreen || el.mozRequestFullScreen || el.msRequestFullScreen,  
            wscript;  

        if(typeof rfs != "undefined" && rfs) {  ////////
            rfs.call(el);  
            return;  
        } 

        if(typeof window.ActiveXObject != "undefined") {  
            wscript = new ActiveXObject("WScript.Shell");  
            if(wscript) {  
                wscript.SendKeys("{F11}");  
            }  
        }  
    }  
	

    /******************** INIT ZoomMarker here *****************************/
    $(document).ready(function () {


		fullScreen(document.documentElement);
	
        $('#scene-pos1').hide();

        $('#btn_back').click(function(){
            $('#scene-map').show();
            $('#scene-pos1').hide();
        });

            
        $('.fancybox').fancybox();
        $("#btn_360").click(function() {
                $.fancybox.open({
                    href : '360.html',
                    type : 'iframe',
                    padding : 5
                });
            });


        $('#zoom-marker-img').zoomMarker({
            src: "img/map.png",
            rate: 0.2,
            width: 800,
            max: 3000,
            markers:[
                

                {
                    src:"img/icon_a.png",name:"太和殿", x:561.1,y:967.5,draggable:false,dialog:{value: "<h4>太和殿</h4>",offsetX: 20}
                },
                {
                    src:"img/icon_a.png",name:"中和殿", x:562.8,y:873.8,draggable:false,dialog:{value: "<h4>中和殿</h4>",offsetX: 20}
                },
                {
                    src:"img/icon_a.png",name:"保和殿", x:562.8,y:792.5,draggable:false,dialog:{value: "<h4>保和殿</h4>",offsetX: 20}
                },
                

            ],
            enable_canvas: false,
            move_limit: false
        });
    })


</script>



</html>
